@startuml
'https://plantuml.com/sequence-diagram

autonumber
@startuml
title US09: As a Power User [or Administrator], I want to get a list of all devices in a house, grouped by device functionality types. It must include device location.

autonumber

participant "_getDevices:GetListOfDevicesByFunctionalityController" as C
participant ":House" as H
participant "devicesByRoom:Map<String, List<Device>>" as DBR
participant ":Room" as R
participant ":Catalog" as Cat
participant ":MapperToGroupDeviceDTO" as M
participant ":DeviceDTO" as DDTO
participant "_myMap:Hashmap" as HM


[o-> C : getDeviceByFunctionality()
activate C
C -> H : getDevicesGroupedByRoom()
activate H
H-->DBR** : create()
loop for each room
H -> R : getDeviceList()
activate R
R -> H : _deviceList
deactivate R
H -> DBR : devicesByRoom.put(roomName, _deviceList)
activate DBR
deactivate DBR
end
H --> C : devicesByRoom
deactivate H



C -> H : getCatalog()
activate H
H --> C : _catalog
deactivate H
C -> Cat : getFunctionalities()
activate Cat
Cat --> C : _availableFunctionalities
deactivate Cat
C -> M : groupDevicesByFunctionality(devicesByRoom, _availableFunctionalities)
activate M
M --> HM** : create Hashmap<> _myMap
Loop for each availableFunctionality
M -> HM : devicesPerFunctionality.put(functionality, new ArrayList<>());
activate HM
deactivate HM
end
Loop for each device
M -> M : getFunctionalities()
M -> DDTO** : create DeviceDTO _deviceDTO
Loop for each functionality
M -> HM : get(functionality).add(device)
activate HM
deactivate HM
end
end
M -> C : _myMap
deactivate M
[o<- C : _myMap
deactivate C


note left #LightBlue
Assuming success
end note

@enduml

@enduml